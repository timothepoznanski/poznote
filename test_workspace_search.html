<!DOCTYPE html>
<html>
<head>
    <title>Test Workspace Search</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .search-type-btn { margin: 5px; padding: 10px; border: 1px solid #ddd; background: #f9f9f9; }
        .search-type-btn.active { background: #007bff; color: white; }
        .workspace-selector { margin: 10px 0; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Test: Type de recherche lors du changement de workspace</h1>
    
    <div class="test-section">
        <h3>Simulation du comportement</h3>
        
        <div>Type de recherche actuel:</div>
        <button class="search-type-btn active" onclick="setSearchType('notes')">Notes</button>
        <button class="search-type-btn" onclick="setSearchType('tags')">Tags</button>
        <button class="search-type-btn" onclick="setSearchType('folders')">Dossiers</button>
        
        <div class="workspace-selector">
            <label>Workspace: </label>
            <select onchange="simulateWorkspaceChange(this.value)">
                <option value="Poznote">Poznote</option>
                <option value="Test1">Test1</option>
                <option value="Test2">Test2</option>
            </select>
        </div>
        
        <div class="log" id="log">
            Logs du comportement...
        </div>
    </div>
    
    <script>
        let currentSearchType = 'notes';
        
        function setSearchType(type) {
            currentSearchType = type;
            
            // Mettre à jour l'UI
            document.querySelectorAll('.search-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            log(`Type de recherche changé vers: ${type}`);
        }
        
        function simulateWorkspaceChange(workspace) {
            log(`Changement vers workspace: ${workspace}`);
            
            // Simuler ce que fait notre code corrigé
            var url = new URL(window.location.href);
            
            // Supprimer les anciens paramètres
            url.searchParams.delete('preserve_notes');
            url.searchParams.delete('preserve_tags');
            url.searchParams.delete('preserve_folders');
            
            // Ajouter le bon paramètre selon le type actuel
            if (currentSearchType === 'tags') {
                url.searchParams.set('preserve_tags', '1');
                log('Paramètre preserve_tags=1 ajouté à l\'URL');
            } else if (currentSearchType === 'folders') {
                url.searchParams.set('preserve_folders', '1');
                log('Paramètre preserve_folders=1 ajouté à l\'URL');
            } else {
                url.searchParams.set('preserve_notes', '1');
                log('Paramètre preserve_notes=1 ajouté à l\'URL');
            }
            
            url.searchParams.set('workspace', workspace);
            
            log(`URL simulée: ${url.toString()}`);
            
            // Simuler la réinitialisation du searchManager
            setTimeout(() => {
                log('Réinitialisation du searchManager simulée');
                log(`Type de recherche préservé: ${currentSearchType}`);
            }, 100);
        }
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Log initial
        log('Test initialisé avec type de recherche: notes');
    </script>
</body>
</html>
