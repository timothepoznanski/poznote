openapi: 3.0.3
info:
  title: Poznote API
  description: |
    REST API for Poznote - Note-taking application with workspaces, folders, tags and attachments support.
    
    **Authentication:** All endpoints support both HTTP Basic Authentication and Session Authentication.
    - Use HTTP Basic Auth (`-u username:password`) for scripts and automation
    - Use Session Auth for browser-based access (Swagger UI)

    **OIDC / SSO (optional):** Poznote can be configured to authenticate users via OpenID Connect for interactive login.
    - Start the flow: `GET /oidc_login.php`
    - Callback: `GET /oidc_callback.php`
    - Note: OIDC creates user sessions; API authentication for automation still uses HTTP Basic Auth
    
    [View complete curl examples in the README](https://github.com/timothepoznanski/poznote#api-documentation)
  version: 1.0.0

tags:
  - name: Notes Management
  - name: Trash Management
  - name: Folders Management
  - name: Workspaces Management
  - name: Tags Management
  - name: Attachments Management
  - name: Favorites Management
  - name: Backup Management
  - name: Export Management
  - name: Public Sharing
  - name: System Information

security:
  - BasicAuth: []
  - SessionAuth: []

components:
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
    SessionAuth:
      type: apiKey
      in: cookie
      # Poznote sets a custom PHP session cookie name based on the configured port.
      # Default is typically: POZNOTE_SESSION_8040
      name: POZNOTE_SESSION_8040

  schemas:
    Note:
      type: object
      properties:
        id:
          type: integer
        heading:
          type: string
        subheading:
          type: string
        entrycontent:
          type: string
        tags:
          type: string
        folder:
          type: string
        workspace:
          type: string
        favorite:
          type: integer
          enum: [0, 1]
        trash:
          type: integer
          enum: [0, 1]
        type:
          type: string
          enum: [note, markdown, tasklist]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Folder:
      type: object
      properties:
        id:
          type: integer
          example: 12
        name:
          type: string
          example: "Projects"
        workspace:
          type: string
          example: "Personal"
        parent_id:
          type: integer
          nullable: true
          example: null
        path:
          type: string
          example: "Projects/2024/Q1"

    FolderNode:
      allOf:
        - $ref: '#/components/schemas/Folder'
        - type: object
          properties:
            children:
              type: array
              items:
                $ref: '#/components/schemas/FolderNode'

paths:
  /oidc_login.php:
    get:
      tags:
        - System Information
      summary: Start OIDC login (SSO)
      description: |
        Starts the OpenID Connect login flow and redirects the browser to the configured Identity Provider.

        This is a browser endpoint (not intended for scripts).
      responses:
        '302':
          description: Redirect to OIDC provider

  /oidc_callback.php:
    get:
      tags:
        - System Information
      summary: OIDC callback
      description: |
        Callback endpoint for the OpenID Connect authorization code flow.
        Exchanges the `code` for tokens, validates the `id_token`, then creates a session.

        This is a browser endpoint (not intended for scripts).
      responses:
        '200':
          description: HTML redirect page

  /api_list_notes.php:
    get:
      tags:
        - Notes Management
      summary: List notes
      description: Get list of notes with optional filters
      parameters:
        - name: workspace
          in: query
          required: false
          description: "Filter by workspace name (optional)"
          schema:
            type: string
        - name: folder
          in: query
          required: false
          description: "Filter by folder name (optional)"
          schema:
            type: string
        - name: search
          in: query
          required: false
          description: "Text search in note content (optional)"
          schema:
            type: string
        - name: tag
          in: query
          required: false
          description: "Filter by tag (optional)"
          schema:
            type: string
        - name: favorite
          in: query
          required: false
          description: "Filter favorites only - 1=yes, 0=no (optional)"
          schema:
            type: integer
            enum: [0, 1]
        - name: get_folders
          in: query
          required: false
          description: "Return folders list instead of notes (optional)"
          schema:
            type: boolean
      responses:
        '200':
          description: Success

  /api_note_content.php:
    get:
      tags:
        - Notes Management
      summary: Get note content
      description: |
        Returns the raw stored content for a note.

        Provide either:
        - `id` (recommended). You may also provide `workspace` to scope the lookup.
        - or `reference` + `workspace` to resolve by title within a workspace.
          `reference` can be a numeric id or a (partial) title.
      parameters:
        - name: id
          in: query
          required: false
          description: "Note ID (recommended)"
          schema:
            type: integer
            example: 123
        - name: reference
          in: query
          required: false
          description: "Note reference (numeric id or partial title). Requires workspace when used."
          schema:
            type: string
            example: "My Note"
        - name: workspace
          in: query
          required: false
          description: "Workspace name (optional with id, required with reference)"
          schema:
            type: string
            example: "Poznote"
      responses:
        '200':
          description: Note content returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 123
                  heading:
                    type: string
                    example: "My Note"
                  workspace:
                    type: string
                    nullable: true
                    example: "Poznote"
                  type:
                    type: string
                    example: "markdown"
                  content:
                    type: string
                    description: "Raw stored note content (Markdown/HTML/JSON depending on type)"
        '400':
          description: Bad request (missing/invalid parameters)
        '404':
          description: Note not found
        '500':
          description: Server error

  /api_create_note.php:
    post:
      tags:
        - Notes Management
      summary: Create note
      description: Create a new note with content
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - heading
              properties:
                heading:
                  type: string
                  description: "Note title (required)"
                  example: "My New Note"
                entry:
                  type: string
                  description: "HTML content for the note file (optional)"
                  example: "<p>This is the note content</p>"
                entrycontent:
                  type: string
                  description: "Text content for database storage (optional)"
                  example: "This is the note content"
                tags:
                  type: string
                  description: "Comma-separated tags (optional)"
                  example: "work,important"
                folder_name:
                  type: string
                  description: "Folder name to place the note in (optional)"
                  example: "Projects"
                workspace:
                  type: string
                  description: "Workspace name (optional, defaults to first available workspace)"
                  example: "Personal"
                type:
                  type: string
                  enum: [note, markdown, tasklist]
                  description: "Note type (optional, defaults to 'note')"
                  example: "note"
      responses:
        '200':
          description: Note created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 123
        '400':
          description: Bad request (missing/invalid parameters)
        '404':
          description: Workspace not found
        '500':
          description: Server error

  /api_apply_tags.php:
    post:
      tags:
        - Tags Management
      summary: Apply Tags
      description: Add or update tags for a specific note (replaces existing tags). Tags can be provided as a comma-separated string or as an array.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - note_id
                - tags
              properties:
                note_id:
                  type: integer
                  description: "Note ID (required)"
                  example: 123
                tags:
                  oneOf:
                    - type: string
                      description: "Comma-separated tags"
                      example: "work,urgent,meeting"
                    - type: array
                      description: "Array of tags"
                      items:
                        type: string
                      example: ["work", "urgent", "meeting"]
                workspace:
                  type: string
                  description: "Workspace name (optional)"
                  example: "Personal"
      responses:
        '200':
          description: Tags updated successfully

  /api_delete_note.php:
    delete:
      tags:
        - Notes Management
      summary: Delete note
      description: Move note to trash (soft delete)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - note_id
              properties:
                note_id:
                  type: integer
                  description: "Note ID to delete (required)"
                  example: 123
                workspace:
                  type: string
                  description: "Workspace name (optional)"
                  example: "Personal"
                permanent:
                  type: boolean
                  description: "If true, permanently delete the note (optional, default: false)"
                  example: false
      responses:
        '200':
          description: Note moved to trash or permanently deleted successfully

  /api_export_note.php:
    get:
      tags:
        - Notes Management
      summary: Export note
      description: |
        Export a note as a styled HTML document with title, tags, and formatted content.
        Supports two disposition modes:
        - `attachment` (default): Forces download as .html file
        - `inline`: Renders in browser for printing or viewing
      parameters:
        - name: id
          in: query
          required: true
          description: "Note ID (required)"
          schema:
            type: integer
            example: 123
        - name: type
          in: query
          required: true
          description: "Note type (required)"
          schema:
            type: string
            enum: [note, markdown, tasklist]
            example: "note"
        - name: format
          in: query
          required: false
          description: "Export format (optional, default: html)"
          schema:
            type: string
            enum: [html]
            default: html
            example: "html"
        - name: disposition
          in: query
          required: false
          description: "Content disposition (optional, default: attachment)"
          schema:
            type: string
            enum: [attachment, inline]
            default: attachment
            example: "attachment"
      responses:
        '200':
          description: Note exported successfully
          content:
            text/html:
              schema:
                type: string
                description: "Styled HTML document with embedded CSS, title, tags, and note content"
        '400':
          description: Invalid parameters (missing ID, invalid format/disposition)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Note ID is required"
        '403':
          description: Invalid file path (security check failed)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Invalid file path"
        '404':
          description: Note not found or file missing
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Note not found"
        '500':
          description: Export failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Export failed: [error details]"

  /api_list_trash.php:
    get:
      tags:
        - Trash Management
      summary: List trash notes
      description: Get list of notes in trash with optional filters
      parameters:
        - name: workspace
          in: query
          required: false
          description: "Filter by workspace name (optional)"
          schema:
            type: string
            example: "Personal"
        - name: search
          in: query
          required: false
          description: "Search in heading, subheading, and tags (optional)"
          schema:
            type: string
            example: "meeting"
      responses:
        '200':
          description: List of trash notes
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  total:
                    type: integer
                    description: Total number of notes in trash
                    example: 5
                  count:
                    type: integer
                    description: Number of notes returned (after filters)
                    example: 5
                  notes:
                    type: array
                    items:
                      $ref: '#/components/schemas/Note'
                  filters:
                    type: object
                    properties:
                      workspace:
                        type: string
                        nullable: true
                      search:
                        type: string
                        nullable: true

  /api_restore_note.php:
    post:
      tags:
        - Trash Management
      summary: Restore note from trash
      description: Restore a note from trash (set trash = 0)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  description: "Note ID to restore (required)"
                  example: 123
                workspace:
                  type: string
                  description: "Workspace name (optional)"
                  example: "Personal"
      responses:
        '200':
          description: Note restored successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Note restored successfully"
                  note_id:
                    type: integer
                    example: 123
                  note_heading:
                    type: string
                    example: "My restored note"
        '400':
          description: Bad request (note not in trash or ID missing)
        '404':
          description: Note not found

  /api_share_note.php:
    post:
      tags:
        - Notes Management
      summary: Share note
      description: Manage public sharing for a note (create, get, revoke, renew share link, update settings)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - note_id
              properties:
                note_id:
                  type: integer
                  description: "Note ID (required)"
                  example: 123
                action:
                  type: string
                  enum: [create, get, revoke, renew, update_indexable, update_password]
                  description: "Action to perform (optional, default: create)"
                  example: "create"
                  default: "create"
                custom_token:
                  type: string
                  description: "Custom URL token/slug (4-128 chars, letters/numbers/-_.) for create/renew actions (optional)"
                  example: "my-custom-note"
                theme:
                  type: string
                  description: "Theme for public display (optional)"
                  example: "dark"
                indexable:
                  type: integer
                  enum: [0, 1]
                  description: "Whether the note should be indexable by search engines (optional, default: 0)"
                  example: 1
                password:
                  type: string
                  description: "Password to protect the shared note (optional)"
                  example: "secret123"
      responses:
        '200':
          description: Sharing action completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  public:
                    type: boolean
                    description: "Whether the note is publicly shared"
                  url:
                    type: string
                    description: "Public share URL"
                    example: "https://example.com/abc123def"
                  url_query:
                    type: string
                    description: "Alternative URL with query parameter"
                    example: "https://example.com/public_note.php?token=abc123def"
                  url_workspace:
                    type: string
                    description: "Workspace-style URL"
                    example: "https://example.com/workspace/abc123def"
                  indexable:
                    type: integer
                    description: "Indexable status"
                    example: 1
                  hasPassword:
                    type: boolean
                    description: "Whether the shared note is password-protected"
                    example: false
                  workspace:
                    type: string
                    description: "Note's workspace"
                    example: "Personal"
                  revoked:
                    type: boolean
                    description: "True if sharing was revoked"
                    example: false
        '400':
          description: Bad request (invalid parameters)
        '404':
          description: Note not found
        '409':
          description: Conflict (token already in use)

  /api_workspaces.php:
    get:
      tags:
        - Workspaces Management
      summary: List workspaces
      description: Get all available workspaces
      parameters:
        - name: action
          in: query
          required: false
          description: "Action to perform (default: list)"
          schema:
            type: string
            enum: [list]
            default: "list"
      responses:
        '200':
          description: List of workspaces returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  workspaces:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        created:
                          type: string
                          format: date-time
    post:
      tags:
        - Workspaces Management
      summary: Manage workspaces
      description: Create, delete, or rename workspaces
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  title: Create workspace
                  required:
                    - action
                    - name
                  properties:
                    action:
                      type: string
                      enum: [create]
                      example: "create"
                    name:
                      type: string
                      description: "Workspace name (letters, numbers, dash, underscore only)"
                      example: "MyProject"
                - type: object
                  title: Delete workspace
                  required:
                    - action
                    - name
                  properties:
                    action:
                      type: string
                      enum: [delete]
                      example: "delete"
                    name:
                      type: string
                      description: "Workspace name to delete (cannot delete 'Poznote')"
                      example: "OldWorkspace"
                - type: object
                  title: Rename workspace
                  required:
                    - action
                    - old_name
                    - new_name
                  properties:
                    action:
                      type: string
                      enum: [rename]
                      example: "rename"
                    old_name:
                      type: string
                      description: "Current workspace name"
                      example: "OldName"
                    new_name:
                      type: string
                      description: "New workspace name"
                      example: "NewName"
      responses:
        '200':
          description: Workspace operation completed successfully

  /api_list_tags.php:
    get:
      tags:
        - Tags Management
      summary: List all tags
      description: Get all tags with usage count
      parameters:
        - name: workspace
          in: query
          required: false
          description: "Filter by workspace (optional)"
          schema:
            type: string
            example: "Poznote"
      responses:
        '200':
          description: List of tags with counts returned successfully

  /api_favorites.php:
    post:
      tags:
        - Favorites Management
      summary: Toggle favorite
      description: Toggle favorite status for a note (automatically adds or removes from favorites)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
                - note_id
              properties:
                action:
                  type: string
                  enum: [toggle_favorite]
                  description: "Action to perform (required)"
                  example: "toggle_favorite"
                note_id:
                  type: integer
                  description: "Note ID (required)"
                  example: 123
                workspace:
                  type: string
                  description: "Workspace name (optional)"
                  example: "Personal"
      responses:
        '200':
          description: Favorite status toggled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  is_favorite:
                    type: integer
                    enum: [0, 1]
                    description: "New favorite status: 1=favorite, 0=not favorite"

  /api_attachments.php:
    get:
      tags:
        - Attachments Management
      summary: List attachments
      description: Get all attachments for a specific note
      parameters:
        - name: action
          in: query
          required: true
          description: "Action to perform (required)"
          schema:
            type: string
            enum: [list]
            example: "list"
        - name: note_id
          in: query
          required: true
          description: "Note ID (required)"
          schema:
            type: integer
            example: 123
        - name: workspace
          in: query
          required: false
          description: "Workspace name (optional)"
          schema:
            type: string
            example: "Personal"
      responses:
        '200':
          description: List of attachments returned successfully
    post:
      tags:
        - Attachments Management
      summary: Upload attachment
      description: Upload a file and attach it to a note
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - action
                - note_id
                - file
              properties:
                action:
                  type: string
                  enum: [upload]
                  description: "Action to perform (required)"
                  example: "upload"
                note_id:
                  type: integer
                  description: "Note ID (required)"
                  example: 123
                workspace:
                  type: string
                  description: "Workspace name (optional)"
                  example: "Personal"
                file:
                  type: string
                  format: binary
                  description: "File to upload (required)"
      responses:
        '200':
          description: File uploaded successfully

  /api_create_folder.php:
    post:
      tags:
        - Folders Management
      summary: Create folder
      description: |
        Create a new folder in a workspace.

        Supports both:
        - Simple folders: `folder_name`
        - Subfolders: `folder_name` + `parent_folder` (path) or `parent_folder_id`
        - Nested path creation: `folder_path` with optional `create_parents`
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  required:
                    - folder_name
                  properties:
                    folder_name:
                      type: string
                      description: "Folder name (required)"
                      example: "Work Projects"
                    parent_folder:
                      type: string
                      description: "Optional parent folder path (e.g., 'Projects/2024')"
                      example: "Projects"
                    parent_folder_id:
                      type: integer
                      description: "Optional parent folder id (alternative to parent_folder)"
                      example: 12
                    workspace:
                      type: string
                      description: "Workspace name (optional, default: Poznote)"
                      example: "Personal"
                - type: object
                  required:
                    - folder_path
                  properties:
                    folder_path:
                      type: string
                      description: "Folder path to create (e.g., 'Projects/2024/Q1')"
                      example: "Projects/2024/Q1"
                    create_parents:
                      type: boolean
                      description: "If true, creates missing parent folders"
                      example: true
                    workspace:
                      type: string
                      description: "Workspace name (optional, default: Poznote)"
                      example: "Personal"
      responses:
        '200':
          description: Folder created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Folder created successfully"
                  folder:
                    $ref: '#/components/schemas/Folder'
                  created_parents:
                    type: array
                    description: "Only present for folder_path creation when parent folders are created"
                    items:
                      $ref: '#/components/schemas/Folder'
        '400':
          description: Invalid request
        '404':
          description: Workspace or parent folder not found
        '409':
          description: Folder already exists

  /api_list_folders.php:
    get:
      tags:
        - Folders Management
      summary: List folders
      description: |
        List folders for a workspace.

        - When `include_hierarchy=false` (default), returns a flat list with a computed `path`.
        - When `include_hierarchy=true`, returns a tree with `children`.
      parameters:
        - name: workspace
          in: query
          required: false
          description: "Workspace name (optional, default: Poznote)"
          schema:
            type: string
            example: "Personal"
        - name: include_hierarchy
          in: query
          required: false
          description: "If true, return folders as a nested tree"
          schema:
            type: boolean
            example: true
      responses:
        '200':
          description: Folders returned successfully
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      workspace:
                        type: string
                        example: "Personal"
                      include_hierarchy:
                        type: boolean
                        example: false
                      folders:
                        type: array
                        items:
                          $ref: '#/components/schemas/Folder'
                  - type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      workspace:
                        type: string
                        example: "Personal"
                      include_hierarchy:
                        type: boolean
                        example: true
                      folders:
                        type: array
                        items:
                          $ref: '#/components/schemas/FolderNode'
        '404':
          description: Workspace not found

  /api_move_folder.php:
    post:
      tags:
        - Folders Management
      summary: Move folder
      description: |
        Move a folder under a new parent (or to root).

        Provide either `folder_id` or `folder_path` to identify the folder.
        Optionally provide `new_parent_folder_id` or `new_parent_folder` to choose the destination parent.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                workspace:
                  type: string
                  description: "Workspace name (optional; required when using folder_path)"
                  example: "Personal"
                folder_id:
                  type: integer
                  description: "Folder id to move (alternative to folder_path)"
                  example: 34
                folder_path:
                  type: string
                  description: "Folder path to move (alternative to folder_id)"
                  example: "Projects/2024/Q1"
                new_parent_folder_id:
                  type: integer
                  nullable: true
                  description: "Destination parent folder id (null/0 moves to root)"
                  example: 12
                new_parent_folder:
                  type: string
                  description: "Destination parent folder path (alternative to new_parent_folder_id)"
                  example: "Archive/2023"
      responses:
        '200':
          description: Folder moved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Folder moved successfully"
                  folder:
                    $ref: '#/components/schemas/Folder'
        '400':
          description: Invalid request
        '404':
          description: Folder/workspace/parent not found
        '409':
          description: Conflict (cycle or name already exists in destination)

  /api_delete_folder.php:
    delete:
      tags:
        - Folders Management
      summary: Delete folder
      description: Delete a folder and move all its contents to no folder (uncategorized)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - folder_name
              properties:
                folder_name:
                  type: string
                  description: "Folder name to delete (required)"
                  example: "Old Projects"
                folder_id:
                  type: integer
                  description: "Folder ID (optional, alternative to folder_name)"
                  example: 5
                workspace:
                  type: string
                  description: "Workspace name (optional)"
                  example: "Personal"
      responses:
        '200':
          description: Folder deleted successfully
        '400':
          description: Invalid request
        '404':
          description: Folder not found

  /api_backup.php:
    post:
      tags:
        - Backup Management
      summary: Create complete backup
      description: |
        Creates a complete backup ZIP file containing:
        - Database SQL dump
        - All HTML note entries
        - All attachments with metadata
        - Index.html file for offline browsing
        
        **Authentication:** Supports both HTTP Basic Auth and Session Auth.
        
        The backup file is saved in the `data/backups/` directory and can be downloaded using the returned path.
      security:
        - BasicAuth: []
        - SessionAuth: []
      responses:
        '200':
          description: Backup created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Backup created successfully"
                  backup_file:
                    type: string
                    description: Filename of the created backup
                    example: "poznote_backup_2025-10-24_14-30-15.zip"
                  backup_path:
                    type: string
                    description: Relative path to download the backup
                    example: "../data/backups/poznote_backup_2025-10-24_14-30-15.zip"
                  backup_size:
                    type: integer
                    description: Size in bytes
                    example: 1048576
                  backup_size_mb:
                    type: number
                    format: float
                    description: Size in megabytes
                    example: 1.0
                  created_at:
                    type: string
                    format: date-time
                    description: ISO 8601 timestamp of creation
                    example: "2025-10-24T14:30:15+00:00"
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Authentication required"
        '500':
          description: Server error during backup creation
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Failed to create backup file"

  /api_list_backups.php:
    get:
      tags:
        - Backup Management
      summary: List available backups
      description: |
        Returns a list of all available backup files in the backups directory, sorted by creation date (newest first).
        
        **Authentication:** Supports both HTTP Basic Auth and Session Auth.
      security:
        - BasicAuth: []
        - SessionAuth: []
      responses:
        '200':
          description: List of backups returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  backups:
                    type: array
                    items:
                      type: object
                      properties:
                        filename:
                          type: string
                          example: "poznote_backup_2025-10-24_14-30-15.zip"
                        path:
                          type: string
                          example: "../data/backups/poznote_backup_2025-10-24_14-30-15.zip"
                        download_url:
                          type: string
                          example: "api_download_backup.php?filename=poznote_backup_2025-10-24_14-30-15.zip"
                        size:
                          type: integer
                          example: 1048576
                        size_mb:
                          type: number
                          format: float
                          example: 1.0
                        created_at:
                          type: string
                          format: date-time
                          example: "2025-10-24T14:30:15+00:00"
                  total:
                    type: integer
                    description: Total number of backups
                    example: 5
        '401':
          description: Authentication required

  /api_download_backup.php:
    get:
      tags:
        - Backup Management
      summary: Download a backup file
      description: |
        Downloads a specific backup file from the backups directory.
        The file will be sent as a ZIP download.
        
        **Authentication:** Supports both HTTP Basic Auth and Session Auth.
      security:
        - BasicAuth: []
        - SessionAuth: []
      parameters:
        - name: filename
          in: query
          required: true
          description: "Name of the backup file to download (must match pattern poznote_backup_YYYY-MM-DD_HH-MM-SS.zip)"
          schema:
            type: string
            example: "poznote_backup_2025-10-24_14-30-15.zip"
      responses:
        '200':
          description: Backup file download
          content:
            application/zip:
              schema:
                type: string
                format: binary
        '400':
          description: Bad request (missing filename or invalid format)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Invalid backup filename format"
        '401':
          description: Authentication required
        '404':
          description: Backup file not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Backup file not found"

  /api_version.php:
    get:
      tags:
        - System Information
      summary: Check version
      description: Get current version and check if updates are available
      responses:
        '200':
          description: Version information
          content:
            application/json:
              schema:
                type: object
                properties:
                  current_version:
                    type: string
                    description: Current installed version
                    example: "1.0.30"
                  latest_version:
                    type: string
                    description: Latest available version from GitHub
                    example: "1.0.31"
                  is_up_to_date:
                    type: boolean
                    description: Whether the current version is up to date
                    example: false
                  has_update:
                    type: boolean
                    description: Whether an update is available
                    example: true
                  update_available:
                    type: boolean
                    description: Whether an update is available (alias)
                    example: true
        '401':
          description: Authentication required

  /api_update_note.php:
    post:
      tags:
        - Notes Management
      summary: Update note
      description: Update an existing note with new content, title, tags, or folder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - heading
              properties:
                id:
                  type: integer
                  description: "Note ID to update (required)"
                  example: 123
                heading:
                  type: string
                  description: "New note title (required)"
                  example: "Updated Note Title"
                entry:
                  type: string
                  description: "New text/HTML content (optional)"
                  example: "<p>Updated HTML content</p>"
                tags:
                  type: string
                  description: "New comma-separated tags (optional)"
                  example: "work,updated,important"
                folder:
                  type: string
                  description: "New folder name (optional)"
                  example: "Archive"
                folder_id:
                  type: integer
                  description: "New folder ID (optional, preferred over folder name)"
                  example: 456
                workspace:
                  type: string
                  description: "New workspace name (optional)"
                  example: "Personal"
      responses:
        '200':
          description: Note updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  id:
                    type: integer
                    example: 123
                  title:
                    type: string
                    example: "Updated Note Title"
        '400':
          description: Bad request (missing/invalid parameters)
        '404':
          description: Note not found
        '409':
          description: Conflict (duplicate title in folder)
        '500':
          description: Server error

  /api_move_note.php:
    post:
      tags:
        - Notes Management
      summary: Move note
      description: Move a note to a different folder or workspace
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - note_id
              properties:
                note_id:
                  type: string
                  description: "Note ID to move (required)"
                  example: "123"
                folder_name:
                  type: string
                  description: "Target folder name (optional)"
                  example: "Archive"
                folder_id:
                  type: integer
                  description: "Target folder ID (optional, preferred over folder_name)"
                  example: 456
                workspace:
                  type: string
                  description: "Target workspace name (optional)"
                  example: "Personal"
      responses:
        '200':
          description: Note moved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Note moved successfully"
        '400':
          description: Bad request (missing/invalid parameters)
        '404':
          description: Note or target folder not found
        '500':
          description: Server error

  /api_list_notes_with_attachments.php:
    get:
      tags:
        - Notes Management
      summary: List notes with attachments
      description: Get list of all notes that have file attachments
      parameters:
        - name: workspace
          in: query
          required: false
          description: "Filter by workspace name (optional)"
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  notes:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 123
                        heading:
                          type: string
                          example: "Note with attachments"
                        attachments:
                          type: array
                          items:
                            type: object
                            properties:
                              filename:
                                type: string
                                example: "document.pdf"
                              original_name:
                                type: string
                                example: "My Document.pdf"
                              size:
                                type: integer
                                example: 1024000
                        updated:
                          type: string
                          format: date-time
                          example: "2025-01-15 10:30:00"
        '401':
          description: Authentication required

  /api_convert_to_html.php:
    post:
      tags:
        - Notes Management
      summary: Convert markdown note to HTML
      description: Convert a markdown note to HTML note type
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - note_id
              properties:
                note_id:
                  type: integer
                  description: "Note ID to convert (required)"
                  example: 123
      responses:
        '200':
          description: Note converted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Note converted to HTML successfully"
        '400':
          description: Bad request (missing/invalid parameters)
        '404':
          description: Note not found
        '500':
          description: Server error

  /api_convert_to_markdown.php:
    post:
      tags:
        - Notes Management
      summary: Convert HTML note to Markdown
      description: Convert an HTML note to Markdown note type
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - note_id
              properties:
                note_id:
                  type: integer
                  description: "Note ID to convert (required)"
                  example: 123
      responses:
        '200':
          description: Note converted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Note successfully converted to Markdown"
        '400':
          description: Bad request (missing/invalid parameters or note is not HTML)
        '404':
          description: Note not found
        '500':
          description: Server error

  /api_export_folder.php:
    get:
      tags:
        - Export Management
      summary: Export folder
      description: Export a specific folder and all its contents (notes and subfolders) as a ZIP file
      parameters:
        - name: folder_id
          in: query
          required: true
          description: "Folder ID to export"
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: ZIP file download
          content:
            application/zip:
              schema:
                type: string
                format: binary
        '400':
          description: Bad request (missing/invalid parameters)
        '404':
          description: Folder not found
        '500':
          description: Server error

  /api_export_structured.php:
    get:
      tags:
        - Export Management
      summary: Export structured notes
      description: Export all notes and folders in a structured ZIP file preserving folder hierarchy
      parameters:
        - name: workspace
          in: query
          required: false
          description: "Workspace to export (optional, exports all if not specified)"
          schema:
            type: string
            example: "Personal"
      responses:
        '200':
          description: ZIP file download
          content:
            application/zip:
              schema:
                type: string
                format: binary
        '500':
          description: Server error

  /api_export_entries.php:
    get:
      tags:
        - Export Management
      summary: Export all note files
      description: Export all note files as a ZIP archive with HTML index
      parameters:
        - name: workspace
          in: query
          required: false
          description: "Workspace to export (optional, exports all if not specified)"
          schema:
            type: string
            example: "Personal"
      responses:
        '200':
          description: ZIP file download
          content:
            application/zip:
              schema:
                type: string
                format: binary
        '500':
          description: Server error

  /api_export_attachments.php:
    get:
      tags:
        - Export Management
      summary: Export all attachments
      description: Export all file attachments from all notes as a ZIP archive
      responses:
        '200':
          description: ZIP file download or HTML page if no attachments
          content:
            application/zip:
              schema:
                type: string
                format: binary
        '500':
          description: Server error

  /api_list_shared.php:
    get:
      tags:
        - Public Sharing
      summary: List shared notes
      description: Get list of all publicly shared notes
      parameters:
        - name: workspace
          in: query
          required: false
          description: "Filter by workspace name (optional)"
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  shared_notes:
                    type: array
                    items:
                      type: object
                      properties:
                        share_id:
                          type: integer
                          example: 456
                        note_id:
                          type: integer
                          example: 123
                        token:
                          type: string
                          example: "abc123def"
                        theme:
                          type: string
                          example: "light"
                        indexable:
                          type: boolean
                          example: true
                        hasPassword:
                          type: boolean
                          example: false
                        shared_date:
                          type: string
                          format: date-time
                          example: "2025-01-15 10:30:00"
                        heading:
                          type: string
                          example: "Shared Note Title"
                        folder:
                          type: string
                          example: "Projects"
                        workspace:
                          type: string
                          example: "Personal"
                        updated:
                          type: string
                          format: date-time
                          example: "2025-01-15 09:00:00"
                        url:
                          type: string
                          example: "https://example.com/public.php?token=abc123def"
        '401':
          description: Authentication required

  /api_delete_backup.php:
    post:
      tags:
        - Backup Management
      summary: Delete backup
      description: Delete a specific backup file from the server
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - filename
              properties:
                filename:
                  type: string
                  description: "Backup filename to delete (required)"
                  example: "poznote_backup_2025-01-15_10-30-00.zip"
      responses:
        '200':
          description: Backup deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Backup deleted successfully"
        '400':
          description: Bad request (missing/invalid parameters)
        '404':
          description: Backup file not found
        '500':
          description: Server error

  /api_check_updates.php:
    get:
      tags:
        - System Information
      summary: Check for updates
      description: Check if a newer version of Poznote is available
      responses:
        '200':
          description: Update check completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  has_updates:
                    type: boolean
                    description: Whether an update is available
                    example: true
                  current_version:
                    type: string
                    description: Current installed version
                    example: "1.2.3"
                  remote_version:
                    type: string
                    description: Latest available version
                    example: "1.3.0"
                  update_available:
                    type: boolean
                    description: Whether an update is available (alias)
                    example: true
                  error:
                    type: string
                    nullable: true
                    description: Error message if version check failed
                    example: null
        '401':
          description: Authentication required

  /api_i18n.php:
    get:
      tags:
        - System Information
      summary: Get internationalization strings
      description: |
        Get merged translation strings for the user's language.
        No authentication required - used for loading UI translations.
      parameters:
        - name: lang
          in: query
          required: false
          description: "Language override for testing (optional)"
          schema:
            type: string
            example: "fr"
      responses:
        '200':
          description: Translation strings returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  lang:
                    type: string
                    description: Language code
                    example: "en"
                  strings:
                    type: object
                    description: Merged translation dictionary
                    example:
                      "app.name": "Poznote"
                      "common.save": "Save"
        '500':
          description: Server error

  /api_insert_new.php:
    post:
      tags:
        - Notes Management
      summary: Insert new note
      description: Create a new empty note with basic metadata
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - now
              properties:
                now:
                  type: integer
                  description: "Current timestamp (required)"
                  example: 1640995200
                workspace:
                  type: string
                  description: "Workspace name (optional, uses first available if not specified)"
                  example: "Personal"
                folder_id:
                  type: integer
                  description: "Folder ID (optional)"
                  example: 123
                folder:
                  type: string
                  description: "Folder name (optional)"
                  example: "Projects"
                type:
                  type: string
                  enum: [note, markdown, tasklist]
                  description: "Note type (optional, default: note)"
                  example: "markdown"
      responses:
        '200':
          description: Note created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 1
                  id:
                    type: integer
                    description: New note ID
                    example: 456
                  message:
                    type: string
                    example: "Note created successfully"
        '400':
          description: Bad request (missing/invalid parameters)
        '500':
          description: Server error

  /api_folders.php:
    post:
      tags:
        - Folders Management
      summary: Advanced folder operations
      description: Handle various folder-related operations (create, move, get defaults, etc.) - This is a legacy endpoint, prefer using specific endpoints like api_create_folder.php, api_move_folder.php, api_list_folders.php
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  description: "Action to perform (required)"
                  enum: [create, move, delete, get_default_folder_settings, update_default_folder_settings]
                  example: "create"
                workspace:
                  type: string
                  description: "Workspace name (optional)"
                  example: "Poznote"
                folder_name:
                  type: string
                  description: "Folder name (required for create action)"
                  example: "Projects"
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        '400':
          description: Invalid request
        '401':
          description: Authentication required
        '500':
          description: Server error

  /api_empty_trash.php:
    post:
      tags:
        - Trash Management
      summary: Empty trash
      description: Permanently delete all notes in trash and their attachments
      requestBody:
        required: false
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                workspace:
                  type: string
                  description: "Workspace to empty trash for (optional, empties all if not specified)"
                  example: "Personal"
      responses:
        '200':
          description: Trash emptied successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Trash emptied successfully"
                  deleted_count:
                    type: integer
                    example: 5

  /api_permanent_delete.php:
    post:
      tags:
        - Trash Management
      summary: Permanently delete note
      description: Permanently delete a specific note and its attachments (bypasses trash)
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  description: "Note ID to permanently delete (required)"
                  example: 123
                workspace:
                  type: string
                  description: "Workspace name (optional)"
                  example: "Personal"
      responses:
        '200':
          description: Note permanently deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Note permanently deleted"
        '400':
          description: Bad request (missing/invalid parameters)
        '404':
          description: Note not found
